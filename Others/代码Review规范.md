#代码review


### 提交review的步骤

1. 当有一个新的需求时，从develop分支checkout出一个新分支，假设为develop-new-feature
2. 在分支develop-new-feature上编写代码，然后提交到对应的远程分支
3. 在gitlab上创建merge request，源分支选择develop-new-feature，目标分支选择develop
    
    ![%E7%AE%97%E6%B3%95%E9%83%A8%E4%BB%A3%E7%A0%81Review%E8%A7%84%E8%8C%83%202ea75eed62774ae68b53f75eab9e5cb6/Untitled.png](Untitled.png)
4. 以下四个地方需要修改：
    - 方框1 标题简短概括下本次提交的主要内容（不宜超过20个字）
    - 方框2 描述内容：
        - 改动了什么
        - 解决了什么问题
        - 需要代码review的人留意哪些影响比较大的改动
        - **特别需要留意：**如果对基础、公共的组件进行了改动，一定要另起一行特别说明
    - 方框3 选择合适的reviewer
    - 方框4 勾选该复选框，在review通过后gitlab将自动删除远程分支(origin/develop-new-feature)，然后对应的本地分支(develop-new-feature)需自己手动删除
    
    ![%E7%AE%97%E6%B3%95%E9%83%A8%E4%BB%A3%E7%A0%81Review%E8%A7%84%E8%8C%83%202ea75eed62774ae68b53f75eab9e5cb6/Untitled%201.png](Untitled%201.png)
    

### merge request的说明

- 单个merge request代码行数不要太长(不要出现一星期不提merge request，一提直接提一千行代码的情况)，单个merge request涉及的改动尽量保证简单
- 严禁一个merge request里面有多个任务，除非它们是紧密关联的
- merge request提交之后只允许针对review发现问题再次提交代码，除非有充足的理由，严禁在同一个merge request中再次提交其它任务的代码

### review代码时的checklist

**完整性检查**

- 代码是否完全实现了设计文档中提出的功能需求
- 代码是否已按照设计文档进行了集成和Debug
- 代码中是否存在任何没有定义或没有引用到的变量、常数或数据类型

**一致性检查**

- 代码的逻辑是否符合设计文档
- 代码中使用的格式、符号、结构等风格是否保持一致

**正确性检查**

- 代码是否符合制定的标准
- 所有的变量都被正确定义和使用
- 所有的注释都是准确的
- 所有的程序调用都使用了正确的参数个数

**可修改性检查**

- 代码涉及到的常量是否易于修改(如使用配置、定义为类常量、使用专门的常量类等)
- 代码中是否包含了交叉说明或数据字典，以描述程序是如何对变量和常量进行访问的

**可预测性检查**

- 代码所用的开发语言是否具有定义良好的语法和语义
- 是否代码避免了依赖于开发语言缺省提供的功能
- 代码是否无意中陷入了死循环
- 代码是否是否避免了无穷递归**健壮性检查**
- 异常处理和清理（释放）资源
- 代码是否采取措施避免运行时错误（如数组边界溢出、被零除、值越界、堆栈溢出等）

**结构性检查**

- 程序的每个功能是否都作为一个可辩识的代码块存在
- 循环是否只有一个入口

**可追溯性检查**

- 是否有一个交叉引用的框架可以用来在代码和开发文档之间相互对应
- 代码是否包括一个修订历史记录，记录中对代码的修改和原因都有记录
- 是否所有的安全功能都有标识

**可理解性检查**

- 注释是否足够清晰的描述每个子程序
- 是否使用到不明确或不必要的复杂代码，它们是否被清楚的注释
- 使用一些统一的格式化技巧（如缩进、空白等）用来增强代码的清晰度
- 是否在定义命名规则时采用了便于记忆，反映类型等方法
- 每个变量都定义了合法的取值范围
- 代码中的算法是否符合开发文档中描述的数学模型

**可验证性检查**

- 代码中的实现技术是否便于测试
- 测试代码是否完善：单元测试、集成测试、端对端测试、算法效果测试

**可重用性**

- DRY（Do not Repeat Yourself）原则：同一代码不应该重复两次以上
- 考虑可重用的服务，功能和组件
- 考虑通用函数和类

**可扩展性**

- 轻松添加功能，对现有代码进行最小的更改。一个组件可以被更好的组件替换

**安全性**

- 进行身份验证，授权，输入数据验证，避免诸如SQL注入和跨站脚本（XSS）等安全威胁 ，加密敏感数据（密码，信用卡信息等）

**性能**

- 使用合适的数据类型，例如StringBuilder，通用集合类
- 懒加载，异步和并行处理
- 缓存和会话/应用程序数据

### code review的步骤

- reviewer和提交review的人最好能面对面交流，由提交review的人讲解自己负责的代码和相关逻辑
- reviewer在此过程中可以随时提出自己的疑问，同时积极发现隐藏的bug；对这些bug记录在案（在gitlab中评论，如下图所示）
    
    ![%E7%AE%97%E6%B3%95%E9%83%A8%E4%BB%A3%E7%A0%81Review%E8%A7%84%E8%8C%83%202ea75eed62774ae68b53f75eab9e5cb6/Untitled%202.png](Untitled%202.png)
    
- reviewer对每一行代码仔细审核，确保代码的质量
- 提交review的人针对reviewer给出的修改意见修改好代码，更新到远程分支(origin/develop-new-feature)
- 重复以上过程，直到每行代码通过审核

### 注意事项

- 要经常进行code review，短频快而不是憋大招
- 单个code review的时间不宜太长，从发出review申请到review截止，不宜超过24小时
- code review时不要太正式，稍微随意一点，让自己和reviewer放轻松，不让review代码变成一种负担
- 最合适的reviewer应该是能彻底了解和review你的代码，并且能在短时间内完成review的人
- 不要总是只找同一个人来review你的代码，不同的人思考方式、对代码的理解都不一样，多找别的小伙伴review你的代码，还可以增进团队凝聚力
- 保持积极正面的态度，只对代码不对人，reviewer不要抨击别人的代码，质疑别人的能力，提交review的人要虚心接受别人的建议
- 学会享受code review，大家互相学习，互相帮助，这样，每个人的代码质量会越来越好，这个团队会越来越好