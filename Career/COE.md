# **什么是COE？**

COE（Correction Of Error）是源自于亚⻢逊使⽤的⼀套事后总结与分析的系统性⽅法。其通过识别问题的根本原因并追踪识别的⾏动项来解决这些问题，从⽽提⾼服务（或系统）的整体质量并推进负责团队的改进。

# **OE不是！**

COE不是追责！

COE不是寻找问题责任人并问责的过程！

COE不是在问题发生后处罚相关人员的过程！

# **为什么要做COE？**

当系统或者服务遇到严重问题（如1级或者2级报障，亚马逊根据将问题的严重程度分为1-5级，从高到低）并需要深入分析时，就需要进行COE。COE可以帮助团队：

-   通过深入分析导致问题的一些列事件来找出问题的根本原因；
-   通过可追踪和可交付的行动项（Action Items）来解决问题的根本原因；
-   防止问题再次发生；
-   分析问题对业务和客户的影响；
-   将分析得到的经验保留下来并与其他团队和成员分享

# **COE的内容**

-   简要描述出了什么问题
-   问题对业务和客户的影响
-   问题根本原因的详细分析
-   数据和图表
-   安全方面的影响
-   经验教训
-   纠正措施
-   行动项
-   其他信息，例如Onduty系统的ID号、链接等

# **最佳实践**

## **通用原则**

-   确保对所发⽣的事情有清晰⽽全⾯的了解。⽐如，需要查看相关服务的⽇志、报障、邮件讨论或其它相关信息；
-   确保问题⼀发⽣就开始写COE，并且信息⼀旦更新就要及时更新，从⽽保证细节信息得以保留；
-   不要在COE中列出个⼈的姓名，只⽤其⻆角⾊来指代他们
-   COE中不要出现敏感信息（例如客户信息、财务数据等），这⽅⾯的信息只保留尽量少的细节；
-   表达具体明确，不要让⼈猜测或推演

## **概要**

-   提供背景信息，你是谁，你做什么，你的使命。可以提供⼀个WIKI⻚页⾯的链接
-   提供关于被影响⼈员、时间、地点和⽅式的细节信息
-   包含花费多⻓长时间发现和解决的详细信息
-   不要在这⾥填⼊所有细节——概要部分只包含事故的基本信息

## **数据和图表**

-   图表总是使⽤图⽚，因为来⾃链接的数据可能代表了当前状态，⽽不是相关时间段；
-   当要提及预期⾏为的变化时，包含⽤于⽐较的相关阈值和基线；
-   当使⽤多个图来⽐较时，尝试让尺度保持⼀致；
-   要给出最相关的图表，理想情况下，图表要最清晰地展示出客户影响；
-   图要和故障总结⼀致——读者会尝试将要点联系起来——让他们能够轻易的这样做；
-   为坐标轴加标注。度量单位很重要（秒，⼩时，个数，等等）

## **客户影响**

-   清晰、具体
-   尽可能准确地描述事件如何影响客户。避免使⽤这样的词，如严重，⼀定⽐例，⼀些等等；例如：
    -   _xx订单服务在2017年3月15日19点30分至23点47分之间，有25%的调用响应时间超过15秒，造成大约3256个下单失败；_
-   不要提及客户的名字；
-   不要推测对客户业务的影响

## **时间线**

-   编写详细的时间线。这有助于作者和评审⼈员理解事故是如何被处理的；
-   当基于时间线陈述发⽣的事件时，保证时区⼀致；
-   突出重要的⾥程碑；
-   按时间顺序罗列事件；
-   时间线要关注事件本身，并且写清事件的开始和结束事件，不要只是给出团队对事件的看法；
-   时间线最开始是导致问题的那个点，⽽不是团队发现问题的点；
-   确保时间线上超过10-15分钟的中断都由5 why进⾏清晰地解释；
-   时间线上的每个条⽬应该紧随之前条⽬；
-   整个时间线应该讲述关于事故的完整故事

## **5 Whys**

5 Whys是源⾃丰⽥TPS的⼀种问题分析⽅法，该技术可以帮助探索隐藏在特定问题之下的原因和因果关系。5whys法的关键所在：⿎励解决问题的⼈要努⼒避开主观或⾃负的假设和逻辑陷阱，从结果着⼿，沿着因果关系链条，顺藤摸⽠，直⾄找出原有问题的根本原因。**如果问题没有识别出具体的根本原因，纠正措施可能是短期⽅案，也就是说，潜在问题可能再次发⽣**。

-   持续提问直到找出可⾏的根本原因
-   每个根本原因需要有⼀个或多个⾏动项来解决，⾏动项需要有负责⼈和期限；
-   使⽤时不限定只做“5次为什么的探讨”，主要是必须找到根本原因为⽌，有时可能只要3次，有时也许要10次，如古话所⾔：打破砂锅问到底；
-   每个后续的Why应该基于之前步骤给出的理由；
-   具体事件可能有多个根本原因。这种情况下，5 Whys分析会分成有多个根本原因的多个⽅向；
-   5 Whys不要停留在：
    -   ⼈为错误：持续提问直到发现系统或过程的具体问题，当这些问题改正之后，⼈为错误将⽆法再出现；
    -   不存在或效果不理想的规程，查看这些规程和⽂档，看看如何改进或⾃动化；
    -   有时，最后⼀个why指出⼀个⽆法修正的根本原因，如硬件错误造成的问题。这种情况是预料中的，但对于严重问题，应该保持这种深⼊分析；
    -   对于复杂问题造成的事件，它们可能是多种因素的组合结果，最好将5 whys分成独⽴的分⽀，每⼀个分⽀达到相应的根本原因；
-   5 Whys应该为下述问题提供明确的答案：
    -   根本原因：这个问题为什么发⽣？
    -   基于事故响应，决定采⽤如下问题：
        -   探索：为什么花了这么长的时间才发现这个问题？
        -   解决：为什么花了这么长时间解决这个问题？

当分析事件时，发现那些暴露失效链中关键要素的问题是⾮常有⽤的，这些要素引起（本可以避免）或就是事件的反应症状。如下是驱动分析的⾼层问题：

-   事件为什么会发⽣？
-   缺陷引⼊和问题检测之间的时间为什么这么久？
-   从问题检测到我们实施纠正措施，为什么花费了1个⼩时？
-   为什么实施关键缓解措施后花了40分钟才让趋势恢复？
-   为什么监控和报警没有发现问题？
-   为什么正确资源的投⼊要花40分钟？

列举这些问题对于分解复杂的叙述以及总结事件细节是⾄关重要的，这对于评审者快速了解分析的关键要素也很有⽤，或者当呈现故障分析结果中的发现时。

对这些问题应⽤“5 Whys”⽅法可以导致对事件的每个症状更深层的分析和根本原因。

示例可以⻅[8D原因分析：5Why+鱼骨图](https://wiki.bizseer.com/pages/viewpage.action?pageId=37524930)，如，

![[Pasted image 20221017074305.png]]


问题并不是限制在5个，可以问得更多或更少，关键是必须朝着解决问题的⽅向进⾏分析。

## **经验教训、纠正措施、行动项**

-   基于所获经验对组织的流程和最佳实践（设计、开发、测试、部署）做必要的改变;
-   确保COE中的⾏动项及时完成;
-   在整个组织中与其它团队分享经验教训;
-   COE中的⾏动项必须明确，它应该包括名字、描述、具体的负责⼈（可以是不同团队），以及合理的完成⽇期;
-   确保⾏动项及时完成，并通过⼯具追踪这些⾏动项;
-   基于经验教训和问题的根本原因创建⾏动项。每个Why可能有其⾃⼰的⾏动项

## **评审**

-   让你的团队评审COE，也让组织中其它团队的成员评审，这些⼈不需要直接了解事故;
-   基于影响，让⾼P⼈员、⾼级经理及直属领导参与COE评审;
-   基于关联，让外部团队参与COE评审

## **其他**

# **根本原因**

## **什么是可操作的根本原因**

⼀个⼩事故常常有多个根本原因。不仅仅是造成事故本身的原因，像为什么没有被快速修复，或者为什么会带来这么严重的影响，这些都是根本原因。

对于任何影响客户的事故，需要持续地提问直到答案预示着有效的⾏动项。

团队需要：

-   防⽌整个事故再次发⽣⽽影响客户（或者⾄少要极⼤地降低其影响客户的可能性）。这可以被认为是提⾼平均故障间隔时间（MTBF）。
-   预防性措施失效时，降低影响。其中⼀⽅⾯是降低平均修复时间（MTTR）；
-   能够调查：在最差的情况下，你⽆法确定可操作的根本原因，问问⾃⼰为什么不能？采取措施以便确保下次同类事故发⽣时你能够确定可操作的根本原因。

## **什么不是根本原因**

这⾥是⼀些⾮常差的根本原因（紧跟着⼀些问题，这些问题有助于接近可操作的根本原因）：

-   这台主机的CPU利⽤率爆表了；
-   为什么CPU利⽤率会爆表？
-   为什么这台主机的CPU利⽤率爆表会对客户影响这么⼤？（或者，怎样才能降低此类故障影响的功能数量？）
-   为什么花了这么⻓长时间恢复？
-   主机耗尽了内存；
-   为什么内存会被耗尽？
-   在部署到⽣产环境前，我们为什么没有在测试中没有发现内存使⽤升⾼？
-   在它影响到客户前，我们为什么没有在⽣产环境发现内存使⽤升⾼？
-   为什么花了这么⻓长时间恢复？
-   A团队开发的服务B出现故障，我们的服务依赖这个服务。
-   我们的系统为什么不能对服务B的故障有更好的适应性？
-   为什么花这么⻓长时间发现或恢复？

多数有上述根本原因的问题都源于不担责（没有责任⼼）。聚焦在为团队找到有效的⾏动项。

持续改进：避免落⼊过度分析事故的陷阱。还有很多其它问题和⼯作要解决，所以根据客户影响适当地分析每个问题。持续提问直到你找到⾜够的⾏动项可以解决上述的三个需求，之后就停下 来。

重点关注做到出⾊的持续改进⽽不是尝试解决全部潜在的问题。